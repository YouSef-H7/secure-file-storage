# ============================================
# SECURE FILE STORAGE - OIDC Configuration
# ============================================
# Copy this file to .env and fill in your values

# Backend Server
PORT=3000
NODE_ENV=development
DATA_DIR=./data

# JWT (Legacy - for email/password auth, optional)
JWT_SECRET=your-secret-key-here

# ============================================
# OCI IDENTITY DOMAIN (OIDC) - REQUIRED
# ============================================

# 1. Your OCI Identity Domain Issuer URL
#    Format: https://idcs-<domain-id>.identity.oraclecloud.com
#    Find at: Oracle Cloud Console > Identity > Domains > click your domain
#             Copy "Primary Domain URL"
OIDC_ISSUER=https://idcs-YOUR-DOMAIN-ID.identity.oraclecloud.com

# 1b. (OPTIONAL) Explicit OpenID Configuration Discovery URL
#     Only needed if your provider's discovery endpoint differs from the issuer URL.
#     OCI: The discovery document is actually served at the idcs-specific subdomain,
#          even if generic "https://identity.oraclecloud.com" is used elsewhere.
#     If set, this URL takes precedence over auto-construction from OIDC_ISSUER.
#     Format: https://idcs-<domain-id>.identity.oraclecloud.com/.well-known/openid-configuration
# OIDC_DISCOVERY_URL=https://idcs-YOUR-DOMAIN-ID.identity.oraclecloud.com/.well-known/openid-configuration

# 2. Confidential Application Client ID
#    Create at: Oracle Cloud Console > Identity > Applications
#               Create "Confidential Application" â†’ copy Client ID
OIDC_CLIENT_ID=your-client-id-here

# 3. Confidential Application Client Secret
#    Show/Generate at: Applications > Your App > Configuration tab
#                      Copy Client Secret
OIDC_CLIENT_SECRET=your-client-secret-here

# 4. OAuth Redirect URI (must match app registration EXACTLY)
#    Set at: Applications > Your App > Redirect URLs
#    This backend's callback endpoint:
OIDC_REDIRECT_URI=http://localhost:3000/auth/callback

# 5. OAuth Scopes (default: openid,profile,email)
#    Request: openid (required), profile, email, etc
#    Available at: Domain Settings > OpenID Connect Token Configuration
OIDC_SCOPES=openid,profile,email

# ============================================
# Session (BFF Pattern - server-side tokens)
# ============================================

# Secret for encrypting session cookies (random 32+ chars)
SESSION_SECRET=your-session-secret-key-12345678901234567890

# Session cookie security (set to true in production with HTTPS)
# Leave false for local development (http://localhost)
SESSION_COOKIE_SECURE=false

# ============================================
# Frontend Configuration
# ============================================

# Frontend base URL (for CORS)
FRONTEND_BASE_URL=http://localhost:5173

# Redirect after successful OIDC login
FRONTEND_SUCCESS_URL=http://localhost:5173/app

# ============================================
# File Upload
# ============================================

MAX_FILE_MB=25
ALLOWED_MIME=image/png,image/jpeg,application/pdf

# ============================================
# Database (MySQL)
# ============================================

MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_DATABASE=secure_storage
MYSQL_USER=root
MYSQL_PASSWORD=your-password

# ============================================
# SETUP INSTRUCTIONS
# ============================================
# 
# 1. Create OCI Confidential Application:
#    - Oracle Cloud Console > Identity > Applications > + Application
#    - Name: "Secure File Storage" (or your app name)
#    - Application Type: "Confidential Application"
#    - Auth/OAuth Scopes: Select openid, profile, email
#    - Redirect URL: http://localhost:3000/auth/callback
#    - Client ID: Copy to OIDC_CLIENT_ID
#    - Client Secret: Generate & copy to OIDC_CLIENT_SECRET
#
# 2. Get your Issuer URL:
#    - Identity > Domains > click your domain
#    - Copy "Primary Domain URL" to OIDC_ISSUER
#    - Format: https://idcs-<domain-id>.identity.oraclecloud.com
#
# 3. Fill in all OIDC_* variables above
#
# 4. Generate SESSION_SECRET:
#    - Linux/Mac: openssl rand -hex 32
#    - Windows: Use https://www.random.org/strings/
#
# 5. Start backend:
#    npm install
#    npm run dev
#
# 6. Frontend will redirect users to /auth/login
#    which redirects to OCI login page
#
# 7. After user logs in, they're redirected to /auth/callback
#    Backend exchanges code for tokens, creates session
#    Frontend redirected to FRONTEND_SUCCESS_URL with auth=success
#
# ============================================
